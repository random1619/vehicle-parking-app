<!DOCTYPE html>
<html lang="en">
<head>
  <title>User Summary</title>
  <link rel="stylesheet" href="/static/style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <style>
    body {
      background-color: white;
    }
    .navbar-custom {
      background-color: #d4f4dc;
      padding: 12px 20px;
    }
    .navbar-custom a {
      font-weight: bold;
      color: #000;
      text-decoration: none;
      margin: 0 10px;
    }
    .navbar-custom .welcome {
      color: red;
      font-weight: bold;
    }
    .navbar-custom .profile-icon {
      font-size: 1.4rem;
      color: #0d6efd;
      cursor: pointer;
    }
    .summary-container {
      padding: 50px 30px;
      text-align: center;
    }
    .chart-box {
      border: 2px solid #000;
      border-radius: 15px;
      padding: 30px;
      display: inline-block;
      margin-top: 40px;
    }
    .chart-placeholder {
      height: 200px;
      width: 300px;
      background: #f1f1f1;
      border-radius: 10px;
    }
  </style>
</head>
<body>

<div class="navbar-custom d-flex justify-content-between align-items-center">
  <div class="d-flex align-items-center">
    <span class="welcome me-3">Welcome to User</span>
    <a href="{{ url_for('dashboard.user_dashboard') }}">Home</a>
    <a href="{{ url_for('dashboard.user_summary') }}">Summary</a>
    <a href="{{ url_for('auth.login')}}">Logout</a>
  </div>
  <a href="{{ url_for('dashboard.edit_profile') }}"><i class="bi bi-person-circle profile-icon"></i></a>
</div>

<div class="summary-container">
  <div class="chart-box">
    <canvas id="usageChart" width="400" height="250"></canvas>

    <div class="fw-bold">Summary on already used parking spots</div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  async function drawChart() {
    try {
  const response = await fetch('/user/spot_summary_data');
  const data = await response.json();

  if (!data.length) {
    alert("No data available to show.");
    return;
  }

  const labels = data.map(item => item.spot); // fixed key
  const usageCounts = data.map(item => item.usage);

  new Chart(document.getElementById('usageChart'), {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Parking Spot Usage',
        data: usageCounts,
        backgroundColor: ['#82ca9d', '#84b6f4', '#f78da7', '#ffcc5c', '#c49cde'],
        borderColor: '#333',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: 'Used Parking Spots Summary',
          font: { size: 18 }
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: { display: true, text: 'Total Bookings' }
        },
        x: {
          title: { display: true, text: 'Parking Spots' }
        }
      }
    }
  });
} catch (error) {
  console.error("Chart error:", error);
  alert("Failed to load chart data.");
}

  }

  drawChart();
</script>

</body>
</html>
