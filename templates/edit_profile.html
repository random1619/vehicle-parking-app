{% extends "base.html" %}

{% block title %}Edit Profile - Parking App{% endblock %}

{% block nav %}
{% if current_user.role != 'admin' %}
{% include "partials/user_topbar.html" %}
{% endif %}
{% endblock %}

{% block content %}
{% if current_user.role == 'admin' %}
<div class="ops-shell">
  {% include "partials/admin_sidebar.html" %}
  <main class="ops-main">
{% else %}
<div class="page-shell">
  <div class="content-wrap" style="max-width: 820px;">
{% endif %}
    <a href="{% if current_user.role == 'admin' %}{{ url_for('admin.dashboard') }}{% else %}{{ url_for('dashboard.user_dashboard') }}{% endif %}" class="back-link">Back to Dashboard</a>

    <header class="page-header">
      <p class="breadcrumb">Account / Profile</p>
      <h1 class="page-title">Edit Profile</h1>
      <p class="page-subtitle">Update your account information and credentials.</p>
    </header>

    <section class="card" style="margin-bottom: 16px;">
      <div style="display: flex; align-items: center; gap: 14px; flex-wrap: wrap;">
        <div style="width: 54px; height: 54px; border-radius: 50%; background: #eef2ff; color: #1e3a8a; display: inline-flex; align-items: center; justify-content: center; font-family: 'Sora', sans-serif; font-weight: 600; font-size: 1.2rem;">
          {{ current_user.full_name[0].upper() if current_user.full_name else current_user.email[0].upper() }}
        </div>
        <div>
          <div style="font-weight: 600;">{{ current_user.full_name }}</div>
          <div class="notice">{{ current_user.email }}</div>
        </div>
        <span class="badge {% if current_user.role == 'admin' %}badge-danger{% else %}badge-success{% endif %}" style="margin-left: auto;">{{ current_user.role }}</span>
      </div>
    </section>

    <section class="card">
      <form method="POST">
        <div class="form-row">
          <div class="form-group">
            <label for="email" class="form-label">Email Address</label>
            <input type="email" name="email" id="email" class="form-control" value="{{ current_user.email }}" required>
          </div>
          <div class="form-group">
            <label for="full_name" class="form-label">Full Name</label>
            <input type="text" name="full_name" id="full_name" class="form-control" value="{{ current_user.full_name }}" required>
          </div>
        </div>

        <div class="form-group">
          <label for="address" class="form-label">Address</label>
          <input type="text" name="address" id="address" class="form-control" value="{{ current_user.address }}" required>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="pincode" class="form-label">PIN Code</label>
            <input type="text" name="pincode" id="pincode" class="form-control" value="{{ current_user.pincode }}" required pattern="[0-9]{6}" title="6-digit PIN code">
          </div>
          <div class="form-group">
            <label for="new_password" class="form-label">New Password (Optional)</label>
            <input type="password" name="new_password" id="new_password" class="form-control" placeholder="Leave blank to keep current">
          </div>
        </div>

        <div class="form-group">
          <label for="old_password" class="form-label">Current Password</label>
          <input type="password" name="old_password" id="old_password" class="form-control" placeholder="Required to save changes" required>
        </div>

        <div class="form-actions">
          <a href="{% if current_user.role == 'admin' %}{{ url_for('admin.dashboard') }}{% else %}{{ url_for('dashboard.user_dashboard') }}{% endif %}" class="btn btn-secondary">Cancel</a>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </section>
{% if current_user.role == 'admin' %}
  </main>
</div>
{% else %}
  </div>
</div>
{% endif %}
{% endblock %}
